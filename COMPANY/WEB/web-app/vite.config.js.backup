// // import { defineConfig } from "vite";
// // import react from "@vitejs/plugin-react";
// // import { visualizer } from "rollup-plugin-visualizer";
// // import compression from "vite-plugin-compression";

// // /**
// //  * OPTIMIZED VITE CONFIG FOR LIGHTHOUSE PERFORMANCE
// //  *
// //  * Key Optimizations:
// //  * 1. esbuild minification (faster than terser, smaller output)
// //  * 2. Code splitting with intelligent chunking for optimal caching
// //  * 3. Gzip/Brotli compression for smaller network payload
// //  * 4. CSS code splitting to prevent render-blocking CSS
// //  * 5. Dependency pre-bundling for faster cold starts
// //  * 6. Asset inlining threshold tuned for performance
// //  */
// // export default defineConfig(({ mode }) => {
// //   const isCapacitor = mode === "capacitor";

// //   return {
// //     plugins: [
// //       react({
// //         // PERFORMANCE: Enable Fast Refresh only in dev
// //         fastRefresh: true,
// //       }),

// //       // PERFORMANCE: Only compress for web deployment, not mobile apps
// //       !isCapacitor && compression({ algorithm: "gzip", ext: ".gz" }),
// //       !isCapacitor && compression({ algorithm: "brotlicompress", ext: ".br" }),

// //       // Bundle analysis to identify optimization opportunities
// //       visualizer({ open: false, gzipSize: true }),
// //     ].filter(Boolean),

// //     server: {
// //       // PERFORMANCE: Enable compression during dev for realistic testing
// //       middlewareMode: false,
// //       host: true,
// //     },

// //     build: {
// //       // PERFORMANCE: esbuild is faster and produces smaller output than terser
// //       minify: "esbuild",

// //       // PERFORMANCE: Keep chunks under 200KB for optimal caching
// //       chunkSizeWarningLimit: 200,

// //       // PERFORMANCE: Inline small assets to reduce HTTP requests
// //       assetsInlineLimit: 4096,

// //       // PERFORMANCE: Enable CSS code splitting for non-render-blocking CSS
// //       cssCodeSplit: true,

// //       // PERFORMANCE: Generate source maps only in dev
// //       sourcemap: process.env.NODE_ENV === "development",

// //       rollupOptions: {
// //         // PERFORMANCE: Intelligent code splitting strategy
// //         output: {
// //           // Split vendor code for better browser caching
// //           // Each chunk changes independently, preventing full app re-download
// //           manualChunks: {
// //             // React core - unlikely to change
// //             "vendor-react": ["react", "react-dom"],

// //             // State management & routing - often updated together
// //             "vendor-redux": ["@reduxjs/toolkit", "react-redux"],
// //             "vendor-router": ["react-router-dom"],

// //             // UI libraries - visual updates
// //             "vendor-ui": ["lucide-react", "recharts"],

// //             // Animations - optimize loading
// //             "vendor-animation": ["framer-motion"],

// //             // Utilities
// //             "vendor-utils": ["axios", "jwt-decode"],
// //           },

// //           // PERFORMANCE: Hash file names for aggressive caching
// //           chunkFileNames: "assets/js/[name]-[hash].js",
// //           entryFileNames: "assets/js/[name]-[hash].js",
// //           assetFileNames: "assets/[ext]/[name]-[hash].[ext]",
// //         },

// //         // PERFORMANCE: Tree-shake unused code
// //         treeshake: {
// //           moduleSideEffects: false,
// //           propertyReadSideEffects: false,
// //           tryCatchDeoptimization: false,
// //         },
// //       },
// //     },

// //     // PERFORMANCE: Pre-bundle heavy dependencies for faster cold starts
// //     optimizeDeps: {
// //       include: [
// //         "react",
// //         "react-dom",
// //         "@reduxjs/toolkit",
// //         "react-redux",
// //         "react-router-dom",
// //         "axios",
// //         "framer-motion",
// //         "jwt-decode",
// //         "lucide-react",
// //       ],
// //     },
// //   };
// // });

// import { defineConfig } from "vite";
// import react from "@vitejs/plugin-react";
// import { visualizer } from "rollup-plugin-visualizer";
// import { compression } from "vite-plugin-compression2"; // Fixed: Modern version

// /**
//  * OPTIMIZED VITE CONFIG
//  * Fixes: Empty chunks & Linux absolute path errors
//  */
// export default defineConfig(({ mode }) => {
//   const isCapacitor = mode === "capacitor";

//   return {
//     plugins: [
//       react({ fastRefresh: true }),

//       // PERFORMANCE: Standardized compression logic
//       !isCapacitor &&
//         compression({
//           algorithm: "gzip",
//           exclude: [/\.(br)$/, /\.(gz)$/],
//         }),
//       ...(isCapacitor
//         ? []
//         : [
//             compression({
//               algorithm: "brotliCompress",
//               exclude: [/\.(br)$/, /\.(gz)$/],
//             }),
//           ]),

//       visualizer({
//         open: false,
//         gzipSize: true,
//         filename: "dist/stats.html",
//       }),
//     ].filter(Boolean),

//     server: {
//       host: true,
//     },

//     build: {
//       minify: "esbuild",
//       chunkSizeWarningLimit: 500, // Adjusted for standard vendor chunks
//       assetsInlineLimit: 4096,
//       cssCodeSplit: true,
//       sourcemap: mode === "development",

//       rollupOptions: {
//         output: {
//           // FIXED: Function-based chunking prevents 0kB files
//           manualChunks(id) {
//             if (id.includes("node_modules")) {
//               // Group major libraries only if they are actually used
//               if (
//                 id.includes("react") ||
//                 id.includes("react-dom") ||
//                 id.includes("react-router")
//               ) {
//                 return "vendor-core";
//               }
//               if (id.includes("framer-motion") || id.includes("lucide")) {
//                 return "vendor-ui";
//               }
//               // Catch-all for other dependencies to prevent fragmentation
//               return "vendor-libs";
//             }
//           },
//           chunkFileNames: "assets/js/[name]-[hash].js",
//           entryFileNames: "assets/js/[name]-[hash].js",
//           assetFileNames: "assets/[ext]/[name]-[hash].[ext]",
//         },

//         treeshake: {
//           moduleSideEffects: false,
//           propertyReadSideEffects: false,
//           tryCatchDeoptimization: false,
//         },
//       },
//     },

//     // PERFORMANCE: Pre-bundle core dependencies
//     optimizeDeps: {
//       include: [
//         "react",
//         "react-dom",
//         "react-router-dom",
//         "axios",
//         "framer-motion",
//         "lucide-react",
//       ],
//     },
//   };
// });

// import { defineConfig } from "vite";
// import react from "@vitejs/plugin-react";
// import { visualizer } from "rollup-plugin-visualizer";

// // https://vite.dev/config/
// export default defineConfig({
//   plugins: [
//     react(),
//     visualizer({
//       open: false,
//       gzipSize: true,
//       brotliSize: true,
//     }),
//   ],
//   server: {
//     host: true,
//     middlewareMode: false,
//   },
//   build: {
//     rollupOptions: {
//       output: {
//         manualChunks: {
//           "vendor-redux": ["@reduxjs/toolkit", "react-redux"],
//           "vendor-routing": ["react-router-dom"],
//           "vendor-ui": ["lucide-react", "recharts"],
//           "vendor-other": ["axios", "framer-motion", "jwt-decode"],
//         },
//         chunkFileNames: "js/[name]-[hash].js",
//         entryFileNames: "js/[name]-[hash].js",
//       },
//       treeshake: {
//         moduleSideEffects: false,
//         propertyReadSideEffects: false,
//       },
//     },
//     minify: "terser",
//     terserOptions: {
//       compress: {
//         drop_console: true,
//         drop_debugger: true,
//       },
//     },
//     cssCodeSplit: true,
//     chunkSizeWarningLimit: 200,
//   },
//   optimizeDeps: {
//     include: [
//       "@reduxjs/toolkit",
//       "react-redux",
//       "react-router-dom",
//       "axios",
//       "jwt-decode",
//     ],
//   },
// });

